{% extends 'templatesApp/base.html' %}
{% load static %}

{% block title %}{{ accion }} Asignación de Rol - Sistema de Buses{% endblock %}

{% block page_title %}{{ accion }} Asignación de Rol{% endblock %}

{% block breadcrumb %}
    <li class="breadcrumb-item"><a href="{% url 'index' %}">Inicio</a></li>
    <li class="breadcrumb-item"><a href="{% url 'asignaciones_rol_list' %}">Asignaciones de Rol</a></li>
    <li class="breadcrumb-item active">{{ accion }}</li>
{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-10">
        <div class="card shadow-sm">
            <div class="card-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <h4 class="mb-0">
                    <i class="bi bi-person-check-fill"></i> {{ accion }} Asignación de Rol
                </h4>
            </div>
            
            <div class="card-body p-4">
                <!-- Errores generales del formulario -->
                {% if form.non_field_errors %}
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                        <i class="bi bi-exclamation-triangle-fill"></i>
                        {{ form.non_field_errors }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endif %}
                
                <form method="post" novalidate>
                    {% csrf_token %}
                    
                    <!-- SECCIÓN: Información del Trabajador -->
                    <div class="card mb-4 border-primary">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">
                                <i class="bi bi-person-fill"></i> Información del Trabajador
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-12 mb-3">
                                    <label for="{{ form.trabajador.id_for_label }}" class="form-label fw-bold">
                                        {{ form.trabajador.label }}
                                        {% if form.trabajador.field.required %}
                                            <span class="text-danger">*</span>
                                        {% endif %}
                                    </label>
                                    {{ form.trabajador }}
                                    
                                    {% if form.trabajador.help_text %}
                                        <div class="form-text">
                                            <i class="bi bi-info-circle"></i> {{ form.trabajador.help_text }}
                                        </div>
                                    {% endif %}
                                    
                                    {% if form.trabajador.errors %}
                                        <div class="invalid-feedback d-block">
                                            {% for error in form.trabajador.errors %}
                                                <i class="bi bi-exclamation-circle"></i> {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <!-- Información adicional si estamos editando -->
                            {% if asignacion %}
                                <div class="alert alert-info">
                                    <i class="bi bi-info-circle-fill"></i>
                                    <strong>Trabajador actual:</strong> {{ asignacion.trabajador }}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- SECCIÓN: Información del Rol -->
                    <div class="card mb-4 border-success">
                        <div class="card-header bg-success text-white">
                            <h5 class="mb-0">
                                <i class="bi bi-briefcase-fill"></i> Información del Rol
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-12 mb-3">
                                    <label for="{{ form.rol.id_for_label }}" class="form-label fw-bold">
                                        {{ form.rol.label }}
                                        {% if form.rol.field.required %}
                                            <span class="text-danger">*</span>
                                        {% endif %}
                                    </label>
                                    {{ form.rol }}
                                    
                                    {% if form.rol.help_text %}
                                        <div class="form-text">
                                            <i class="bi bi-info-circle"></i> {{ form.rol.help_text }}
                                        </div>
                                    {% endif %}
                                    
                                    {% if form.rol.errors %}
                                        <div class="invalid-feedback d-block">
                                            {% for error in form.rol.errors %}
                                                <i class="bi bi-exclamation-circle"></i> {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <!-- Información adicional si estamos editando -->
                            {% if asignacion %}
                                <div class="alert alert-info">
                                    <i class="bi bi-info-circle-fill"></i>
                                    <strong>Rol actual:</strong> {{ asignacion.rol }}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- SECCIÓN: Fechas -->
                    <div class="card mb-4 border-warning">
                        <div class="card-header bg-warning">
                            <h5 class="mb-0">
                                <i class="bi bi-calendar-event-fill"></i> Fechas
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="{{ form.fecha_finalizacion.id_for_label }}" class="form-label fw-bold">
                                        {{ form.fecha_finalizacion.label }}
                                        {% if form.fecha_finalizacion.field.required %}
                                            <span class="text-danger">*</span>
                                        {% endif %}
                                    </label>
                                    {{ form.fecha_finalizacion }}
                                    
                                    {% if form.fecha_finalizacion.help_text %}
                                        <div class="form-text">
                                            <i class="bi bi-info-circle"></i> {{ form.fecha_finalizacion.help_text }}
                                        </div>
                                    {% endif %}
                                    
                                    {% if form.fecha_finalizacion.errors %}
                                        <div class="invalid-feedback d-block">
                                            {% for error in form.fecha_finalizacion.errors %}
                                                <i class="bi bi-exclamation-circle"></i> {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <div class="form-check form-switch" style="margin-top: 40px;">
                                        {{ form.activo }}
                                        <label class="form-check-label fw-bold" for="{{ form.activo.id_for_label }}">
                                            {{ form.activo.label }}
                                        </label>
                                        
                                        {% if form.activo.help_text %}
                                            <div class="form-text">
                                                <i class="bi bi-info-circle"></i> {{ form.activo.help_text }}
                                            </div>
                                        {% endif %}
                                        
                                        {% if form.activo.errors %}
                                            <div class="invalid-feedback d-block">
                                                {% for error in form.activo.errors %}
                                                    <i class="bi bi-exclamation-circle"></i> {{ error }}
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            {% if asignacion and asignacion.fecha_asignacion %}
                                <div class="alert alert-secondary">
                                    <i class="bi bi-calendar-check"></i>
                                    <strong>Fecha de asignación:</strong> {{ asignacion.fecha_asignacion|date:"d/m/Y" }}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- SECCIÓN: Notas (si el campo existe) -->
                    {% if form.notas %}
                    <div class="card mb-4 border-info">
                        <div class="card-header bg-info text-white">
                            <h5 class="mb-0">
                                <i class="bi bi-sticky-fill"></i> Notas Adicionales
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-12 mb-3">
                                    <label for="{{ form.notas.id_for_label }}" class="form-label fw-bold">
                                        {{ form.notas.label }}
                                    </label>
                                    {{ form.notas }}
                                    
                                    {% if form.notas.help_text %}
                                        <div class="form-text">
                                            <i class="bi bi-info-circle"></i> {{ form.notas.help_text }}
                                        </div>
                                    {% endif %}
                                    
                                    {% if form.notas.errors %}
                                        <div class="invalid-feedback d-block">
                                            {% for error in form.notas.errors %}
                                                <i class="bi bi-exclamation-circle"></i> {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    
                    <!-- Botones de acción -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                <a href="{% url 'asignaciones_rol_list' %}" class="btn btn-secondary btn-lg">
                                    <i class="bi bi-arrow-left"></i> Cancelar
                                </a>
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="bi bi-save"></i> {{ accion }} Asignación
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Ayuda adicional -->
        <div class="card mt-4 border-0" style="background-color: #f8f9fa;">
            <div class="card-body">
                <h6 class="text-muted">
                    <i class="bi bi-lightbulb"></i> Consejos:
                </h6>
                <ul class="text-muted small mb-0">
                    <li>Seleccione el trabajador y el rol que desea asignar</li>
                    <li>La fecha de finalización es opcional</li>
                    <li>Marque "Asignación Activa" si la asignación está vigente</li>
                    <li>Los campos marcados con <span class="text-danger">*</span> son obligatorios</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<style>
    .form-control, .form-select {
        border-radius: 8px;
        border: 2px solid #e0e0e0;
        padding: 10px 15px;
        transition: all 0.3s;
    }
    
    .form-control:focus, .form-select:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
    }
    
    .form-check-input {
        width: 3em;
        height: 1.5em;
        cursor: pointer;
    }
    
    .card-header {
        border-radius: 8px 8px 0 0 !important;
    }
    
    .btn-lg {
        padding: 12px 30px;
        border-radius: 8px;
    }
</style>
{% endblock %}