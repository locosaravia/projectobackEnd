{% extends 'templatesApp/base.html' %}

{% block title %}{{ bus.patente }} - {{ bus.modelo }}{% endblock %}

{% block page_title %}{{ bus.patente }} - {{ bus.modelo }}{% endblock %}

{% block breadcrumb %}
    <li class="breadcrumb-item"><a href="{% url 'index' %}">Inicio</a></li>
    <li class="breadcrumb-item"><a href="{% url 'buses_list' %}">Buses</a></li>
    <li class="breadcrumb-item active">{{ bus.patente }}</li>
{% endblock %}

{% block content %}
<div class="row">
    <!-- Información del bus -->
    <div class="col-md-8">
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="bi bi-info-circle"></i> Información del Bus</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <strong>Patente:</strong>
                            <p class="text-muted">{{ bus.patente }}</p>
                        </div>
                        <div class="mb-3">
                            <strong>Marca:</strong>
                            <p class="text-muted">{{ bus.marca }}</p>
                        </div>
                        <div class="mb-3">
                            <strong>Modelo:</strong>
                            <p class="text-muted">{{ bus.modelo }}</p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <strong>Año:</strong>
                            <p class="text-muted">{{ bus.año }}</p>
                        </div>
                        <div class="mb-3">
                            <strong>Capacidad:</strong>
                            <p class="text-muted">{{ bus.capacidad }} pasajeros</p>
                        </div>
                        <div class="mb-3">
                            <strong>Estado:</strong>
                            <p>
                                {% if bus.activo %}
                                    <span class="badge bg-success"><i class="bi bi-check-circle"></i> Activo</span>
                                {% else %}
                                    <span class="badge bg-secondary"><i class="bi bi-x-circle"></i> Inactivo</span>
                                {% endif %}
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Estado del Bus -->
        {% if estado %}
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-warning">
                <h5 class="mb-0"><i class="bi bi-speedometer"></i> Estado Actual del Bus</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <strong>Estado:</strong>
                            <p>
                                {% if estado.estado == 'OPERATIVO' %}
                                    <span class="badge bg-success"><i class="bi bi-check-circle"></i> Operativo</span>
                                {% elif estado.estado == 'MANTENIMIENTO' %}
                                    <span class="badge bg-warning"><i class="bi bi-wrench"></i> Mantenimiento</span>
                                {% elif estado.estado == 'REPARACION' %}
                                    <span class="badge bg-danger"><i class="bi bi-tools"></i> Reparación</span>
                                {% elif estado.estado == 'FUERA_SERVICIO' %}
                                    <span class="badge bg-danger"><i class="bi bi-x-circle"></i> Fuera de Servicio</span>
                                {% elif estado.estado == 'RESERVADO' %}
                                    <span class="badge bg-info"><i class="bi bi-lock"></i> Reservado</span>
                                {% endif %}
                            </p>
                        </div>
                        <div class="mb-3">
                            <strong>Kilometraje:</strong>
                            <p class="text-muted">{{ estado.kilometraje|default:"0" }} km</p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <strong>Último cambio:</strong>
                            <p class="text-muted">{{ estado.fecha_cambio|date:"d/m/Y H:i" }}</p>
                        </div>
                    </div>
                </div>
                {% if estado.observaciones %}
                <hr>
                <div class="mb-3">
                    <strong>Observaciones:</strong>
                    <p class="text-muted">{{ estado.observaciones }}</p>
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}

        <!-- Asignaciones del Bus -->
        <div class="card shadow-sm">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0"><i class="bi bi-people"></i> Asignaciones a Conductores</h5>
            </div>
            <div class="card-body">
                {% if asignaciones %}
                <div class="table-responsive">
                    <table class="table table-sm table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>Conductor</th>
                                <th>Turno</th>
                                <th>Inicio</th>
                                <th>Fin</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for asignacion in asignaciones %}
                            <tr>
                                <td><strong>{{ asignacion.trabajador }}</strong></td>
                                <td>
                                    {% if asignacion.turno == 'MAÑANA' %}
                                        <span class="badge bg-warning"><i class="bi bi-sun"></i> Mañana</span>
                                    {% elif asignacion.turno == 'TARDE' %}
                                        <span class="badge bg-info"><i class="bi bi-cloud"></i> Tarde</span>
                                    {% elif asignacion.turno == 'NOCHE' %}
                                        <span class="badge bg-dark"><i class="bi bi-moon"></i> Noche</span>
                                    {% endif %}
                                </td>
                                <td>{{ asignacion.fecha_asignacion|date:"d/m/Y" }}</td>
                                <td>
                                    {% if asignacion.fecha_finalizacion %}
                                        {{ asignacion.fecha_finalizacion|date:"d/m/Y" }}
                                    {% else %}
                                        <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if asignacion.activo %}
                                        <span class="badge bg-success">Activa</span>
                                    {% else %}
                                        <span class="badge bg-secondary">Inactiva</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-muted mb-0">No tiene asignaciones de conductores registradas.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Panel de acciones -->
    <div class="col-md-4">
        <div class="card shadow-sm sticky-top" style="top: 20px;">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0"><i class="bi bi-gear"></i> Acciones</h5>
            </div>
            <div class="card-body d-grid gap-2">
                <a href="{% url 'bus_editar' bus.pk %}" class="btn btn-warning">
                    <i class="bi bi-pencil"></i> Editar
                </a>
                <a href="{% url 'bus_eliminar' bus.pk %}" class="btn btn-danger" onclick="return confirm('¿Está seguro de que desea eliminar este bus?')">
                    <i class="bi bi-trash"></i> Eliminar
                </a>
                <a href="{% url 'buses_list' %}" class="btn btn-primary">
                    <i class="bi bi-list"></i> Ver Todos
                </a>
                <a href="{% url 'index' %}" class="btn btn-secondary">
                    <i class="bi bi-arrow-left"></i> Volver
                </a>
            </div>
        </div>

        <!-- Información adicional -->
        <div class="card shadow-sm mt-3">
            <div class="card-header bg-light">
                <h6 class="mb-0"><i class="bi bi-info-circle"></i> Información</h6>
            </div>
            <div class="card-body">
                <p class="mb-2"><strong>ID:</strong> {{ bus.id }}</p>
                <p class="mb-2"><strong>Patente:</strong> {{ bus.patente }}</p>
                <p class="mb-2"><strong>Año:</strong> {{ bus.año }}</p>
                <p class="mb-0"><strong>Capacidad:</strong> {{ bus.capacidad }} pasajeros</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}